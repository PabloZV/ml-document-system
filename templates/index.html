<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Processing System</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; }
        .card { background: white; padding: 30px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .upload-area { border: 2px dashed #4299e1; padding: 40px; text-align: center; border-radius: 8px; background-color: #f8fafc; cursor: pointer; }
        .upload-area:hover { background-color: #edf2f7; }
        button { background: #4299e1; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
        button:hover { background: #3182ce; }
        button:disabled { background: #a0aec0; cursor: not-allowed; }
        .response-box { background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 6px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; margin-top: 20px; }
        .loading { color: #4299e1; font-style: italic; }
        .error { color: #e53e3e; background: #fed7d7; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .success { color: #38a169; background: #c6f6d5; padding: 15px; border-radius: 6px; margin: 10px 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: #4299e1; color: white; padding: 20px; border-radius: 8px; text-align: center; }
        .api-link { display: inline-block; margin: 10px 10px 10px 0; padding: 8px 16px; background: #e2e8f0; color: #2d3748; text-decoration: none; border-radius: 4px; }
        .api-link:hover { background: #cbd5e0; }
        input[type="text"], input[type="number"] { padding: 10px; border: 1px solid #cbd5e0; border-radius: 4px; }
        .search-results { max-height: 500px; overflow-y: auto; }
        .search-result-item { transition: transform 0.2s ease; }
        .search-result-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important; }
        .api-endpoint { background: #e8f4fd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .code { background: #2d3748; color: #e2e8f0; padding: 10px; border-radius: 4px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Document Processing System</h1>
    
    <div class="card">
        <h2>Welcome to the Document Processing System</h2>
        <p style="font-size: 16px; line-height: 1.6; color: #4a5568;">
            This system uses advanced <strong>Machine Learning</strong> and <strong>Natural Language Processing</strong> to analyze document images. 
            Here's how to get started:
        </p>
        
        <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #2d3748;">How to Use This System:</h3>
            <ol style="line-height: 1.8; color: #4a5568;">
                <li><strong>Check Statistics:</strong> View current documents and categories in the system</li>
                <li><strong>Upload Documents:</strong> Click the upload area to select JPG/JPEG images (max 10MB)</li>
                <li><strong>Automatic Processing:</strong> The system will:
                    <ul style="margin: 10px 0;">
                        <li>Extract text using OCR (Optical Character Recognition)</li>
                        <li>Classify document type (advertisement, invoice, letter, etc.)</li>
                        <li>Extract entities (names, dates, emails, addresses) using BERT AI</li>
                        <li>Store embeddings in ChromaDB for semantic search</li>
                    </ul>
                </li>
                <li><strong>Search Documents:</strong> Use natural language queries to find similar documents</li>
                <li><strong>API Access:</strong> Use REST endpoints for integration with other systems</li>
            </ol>
        </div>
        
        <div style="background: #e6fffa; border-left: 4px solid #38b2ac; padding: 15px; margin: 20px 0;">
            <strong>Tip:</strong> The system works best with clear, well-lit document images. 
            <a href="https://drive.google.com/file/d/1-XkurZxd72b1nN8W-VeCO3vraai6cTIF/view?usp=sharing" 
               target="_blank" 
               style="color: #2b6cb0; text-decoration: underline; font-weight: bold;">
                Download sample documents here
            </a> to test the system.<br>
            <strong>Supported formats:</strong> JPG, JPEG only.
        </div>
    </div>
    
    <div class="card">
        <h2>System Statistics</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="total-docs">Loading...</h3>
                <p>Total Documents</p>
            </div>
            <div class="stat-card">
                <h3 id="categories-count">Loading...</h3>
                <p>Categories</p>
            </div>
        </div>
        <button onclick="loadStats()">Refresh Stats</button>
        
        <div style="margin-top: 20px;">
            <a href="/api/stats/" class="api-link" target="_blank">View Stats API</a>
        </div>
    </div>

    <div class="card">
        <h2>Upload & Process Document</h2>
        <p>Upload an image document to extract text, classify type, and extract entities using LLM:</p>
        
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <h3>Click to Upload Document</h3>
            <p>Supported formats: JPG/JPEG only (Max 10MB)</p>
            <input type="file" id="fileInput" accept=".jpg,.jpeg" style="display: none;" onchange="handleFileSelect(event)">
        </div>
        
        <div id="fileInfo" style="margin: 15px 0; display: none;">
            <strong>Selected:</strong> <span id="fileName"></span> (<span id="fileSize"></span>)
        </div>
        
        <button id="uploadBtn" onclick="processDocument()" disabled>Process Document</button>
        
        <div id="processingStatus"></div>
        
        <div id="responseContainer" style="display: none;">
            <h3>Processing Results</h3>
            <div id="responseBox" class="response-box"></div>
        </div>
    </div>

    <div class="card">
        <h2>Semantic Similarity Search on ChromaDB</h2>
        <p>Search through processed documents using vector similarity in ChromaDB:</p>
        
        <div style="margin: 20px 0;">
            <input type="text" id="semanticSearchQuery" placeholder="Enter search query (e.g., 'advertisement', 'invoice', 'contact information')" style="width: 400px; padding: 12px; margin-right: 10px; border: 2px solid #e2e8f0; border-radius: 6px;">
            <label for="semanticSearchLimit" style="margin-right: 5px; font-weight: bold;">Max Results:</label>
            <input type="number" id="semanticSearchLimit" placeholder="5" value="5" min="1" max="20" style="width: 60px; padding: 12px; margin-right: 10px; border: 2px solid #e2e8f0; border-radius: 6px;">
            <button onclick="performSemanticSearch()" style="padding: 12px 20px; background: #4299e1; color: white; border: none; border-radius: 6px; cursor: pointer;">Search ChromaDB</button>
        </div>
        
        <div id="semanticSearchStatus"></div>
        
        <div id="semanticSearchContainer" style="display: none;">
            <h3>Search Results</h3>
            <div id="semanticSearchResults" class="search-results"></div>
        </div>
    </div>

    <div class="card">
        <h2>API Endpoints</h2>
        
        <div class="api-endpoint">
            <h3>GET /api/stats/</h3>
            <div class="code">curl -X GET http://localhost:8000/api/stats/</div>
        </div>
        
        <div class="api-endpoint">
            <h3>GET /api/search/</h3>
            <div class="code">curl -X GET "http://localhost:8000/api/search/?q=advertisement&limit=5"</div>
        </div>
        
        <div class="api-endpoint">
            <h3>POST /api/process/</h3>
            <div class="code">curl -X POST http://localhost:8000/api/process/ -F "file=@document.jpg"</div>
        </div>

        <div class="api-endpoint">
            <h3>Management Command</h3>
            <div class="code">docker exec -it document-processor python manage.py process_documents --path=data/docs-sm --category=advertisement --limit=5</div>
        </div>
    </div>

    <script>
        let selectedFile = null;

        function handleFileSelect(event) {
            selectedFile = event.target.files[0];
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (selectedFile) {
                fileName.textContent = selectedFile.name;
                fileSize.textContent = (selectedFile.size / (1024*1024)).toFixed(2) + ' MB';
                fileInfo.style.display = 'block';
                uploadBtn.disabled = false;
            }
        }

        async function processDocument() {
            if (!selectedFile) {
                alert('Please select a file first');
                return;
            }

            const statusDiv = document.getElementById('processingStatus');
            const responseContainer = document.getElementById('responseContainer');
            const responseBox = document.getElementById('responseBox');
            const uploadBtn = document.getElementById('uploadBtn');
            
            uploadBtn.disabled = true;
            statusDiv.innerHTML = '<div class="loading">Processing document... This may take a few moments for ML analysis.</div>';
            responseContainer.style.display = 'none';

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const startTime = Date.now();
                const response = await fetch('/api/process/', {
                    method: 'POST',
                    body: formData
                });
                
                const processingTime = ((Date.now() - startTime) / 1000).toFixed(2);
                const data = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = `<div class="success">Document processed successfully in ${processingTime}s!</div>`;
                    responseBox.textContent = JSON.stringify(data, null, 2);
                    responseContainer.style.display = 'block';
                    loadStats();
                } else {
                    statusDiv.innerHTML = `<div class="error">Error: ${data.message || 'Processing failed'}</div>`;
                    responseBox.textContent = JSON.stringify(data, null, 2);
                    responseContainer.style.display = 'block';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">Network error: ${error.message}</div>`;
                console.error('Error:', error);
            } finally {
                uploadBtn.disabled = false;
            }
        }

        async function loadStats() {
            try {
                const response = await fetch('/api/stats/');
                const data = await response.json();
                
                document.getElementById('total-docs').textContent = data.total_documents;
                document.getElementById('categories-count').textContent = Object.keys(data.categories).length;
                
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('total-docs').textContent = 'Error';
                document.getElementById('categories-count').textContent = 'Error';
            }
        }

        async function performSemanticSearch() {
            const query = document.getElementById('semanticSearchQuery').value;
            const limit = document.getElementById('semanticSearchLimit').value || 5;
            const statusDiv = document.getElementById('semanticSearchStatus');
            const containerDiv = document.getElementById('semanticSearchContainer');
            const resultsDiv = document.getElementById('semanticSearchResults');
            
            if (!query.trim()) {
                alert('Please enter a search query');
                return;
            }

            statusDiv.innerHTML = '<div class="loading">Searching ChromaDB using vector similarity...</div>';
            containerDiv.style.display = 'none';

            try {
                const startTime = Date.now();
                const response = await fetch(`/api/search/?q=${encodeURIComponent(query)}&limit=${limit}`);
                const data = await response.json();
                const searchTime = ((Date.now() - startTime) / 1000).toFixed(2);
                
                if (response.ok) {
                    statusDiv.innerHTML = `<div class="success">Found ${data.results.length} results in ${searchTime}s</div>`;
                    
                    if (data.results.length === 0) {
                        resultsDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No similar documents found. Try different keywords.</p>';
                    } else {
                        const resultsHtml = data.results.map((result, index) => `
                            <div style="background: white; padding: 20px; margin: 15px 0; border-left: 4px solid #4299e1; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h4 style="margin: 0; color: #2d3748;">${index + 1}. ${result.metadata.filename}</h4>
                                    <span style="background: #4299e1; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                                        ${(result.similarity * 100).toFixed(1)}% match
                                    </span>
                                </div>
                                <p style="margin: 5px 0;"><strong>Category:</strong> ${result.metadata.category}</p>
                                <p style="margin: 5px 0;"><strong>Word Count:</strong> ${result.metadata.word_count}</p>
                                <p style="margin: 5px 0;"><strong>Similarity Score:</strong> ${result.similarity.toFixed(4)}</p>
                                <div style="background: #f7fafc; padding: 10px; border-radius: 4px; margin-top: 10px;">
                                    <strong>Text Preview:</strong><br>
                                    <em style="color: #4a5568;">${result.text.substring(0, 300)}${result.text.length > 300 ? '...' : ''}</em>
                                </div>
                            </div>
                        `).join('');
                        
                        resultsDiv.innerHTML = resultsHtml;
                    }
                    
                    containerDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = `<div class="error">Search failed: ${data.message || 'Unknown error'}</div>`;
                }
                
            } catch (error) {
                console.error('Error searching:', error);
                statusDiv.innerHTML = '<div class="error">Network error during search</div>';
            }
        }

        // Load stats on page load
        loadStats();
    </script>
</body>
</html>
